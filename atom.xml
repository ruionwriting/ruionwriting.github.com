<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[RuiOnWriting.NET]]></title>
  <link href="http://ruionwriting.net/atom.xml" rel="self"/>
  <link href="http://ruionwriting.net/"/>
  <updated>2014-04-19T17:09:01+01:00</updated>
  <id>http://ruionwriting.net/</id>
  <author>
    <name><![CDATA[Rui Marques]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[SQL Server: (re)import CSV data the easy way]]></title>
    <link href="http://ruionwriting.net/blog/2014/04/12/sql-server-re-import-csv-data-the-easy-way/"/>
    <updated>2014-04-12T19:31:00+01:00</updated>
    <id>http://ruionwriting.net/blog/2014/04/12/sql-server-re-import-csv-data-the-easy-way</id>
    <content type="html"><![CDATA[<p>Importing data into SQL Server is not hard using the import data feature but I really don’t appreciate the fact that there is no way to save that import profile/rules for later reuse. Solution: use BULK INSERT from a regular reusable sql script.</p>

<p><a href="http://technet.microsoft.com/en-us/library/ms188365.aspx">BULK INSERT (Transact-SQL)</a> is a really nice feature that allows to easily create a reusable data import script capable of import one or many CSV files. I’m going to build a simple script using this nice feature.
<!--more--></p>

<p>For this example I have a simple CSV file containing a set of data from a fictional marketing contacts database.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Example CSV source </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class=""><span class="line">Id;Name;EmailAddress;MobileNumber
</span><span class="line">1;John;john@gmail.com;123456789
</span><span class="line">2;Mary;mary@gmail.com;123456789
</span><span class="line">...</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In order to use BULK INSERT I need the target table structure to have the same structure as the source data. Not always this would be the case so I’m going to create a temporary table to hold my source data that will be retrieved from the BULK INSERT.</p>

<p><strong>Creating the temporary table:</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Temporary table to hold CSV data </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">#</span><span class="n">tempSource_Table_Name</span> <span class="p">(</span>
</span><span class="line">    <span class="n">Id</span> <span class="nb">int</span><span class="p">,</span>
</span><span class="line">    <span class="p">[</span><span class="n">Name</span><span class="p">]</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
</span><span class="line">    <span class="n">EmailAddress</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">null</span><span class="p">,</span>
</span><span class="line">    <span class="n">MobileNumber</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">null</span>
</span><span class="line"><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This temporary table columns definitions should reflect the source structure and columns types.</p>

<p>Now that I have a temporary table that can receive the source data from the CSV.</p>

<p><strong>Building the BULK INSERT script:</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>BULK INSERT </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="n">BULK</span> <span class="k">INSERT</span> <span class="o">#</span><span class="n">tempSource_Table_Name</span>
</span><span class="line"><span class="k">FROM</span> <span class="s1">&#39;C:\csv_file_full_path\source_table_data.csv&#39;</span>
</span><span class="line"><span class="k">WITH</span>
</span><span class="line"><span class="p">(</span>
</span><span class="line">    <span class="n">FIRSTROW</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span class="line">    <span class="n">FIELDTERMINATOR</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="n">ROWTERMINATOR</span> <span class="o">=</span> <span class="s1">&#39;\n&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="n">CODEPAGE</span> <span class="o">=</span> <span class="s1">&#39;ACP&#39;</span>
</span><span class="line"><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>I’m just applying a short set of the <a href="http://technet.microsoft.com/en-us/library/ms188365.aspx">available arguments</a>. Based on your data source apply the necessary arguments.</p>

<p>This is a very powerful tool. Just for the example, is possible to have a source data file from a UNC share, take control over encoding, etc.</p>

<p>Now that I have a temporary table containing the imported data I can insert it to my target table applying some extra import rules and tweaks.</p>

<p><strong>Building the insert script for the target table:</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Insert data to target table  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">Target_Table_Name</span><span class="p">]</span>
</span><span class="line">   <span class="p">([</span><span class="n">Name</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">MobileNumber</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">EmailAddress</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">Password</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">LastKnownIPAddress</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">CreatedOn</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">ChangedOn</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">VerifiedOn</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">Blocked</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">BlockEmailMarketing</span><span class="p">])</span>
</span><span class="line"><span class="k">SELECT</span>
</span><span class="line">    <span class="p">[</span><span class="n">Name</span><span class="p">]</span>
</span><span class="line">    <span class="p">,[</span><span class="n">MobileNumber</span><span class="p">]</span>
</span><span class="line">    <span class="p">,(</span>
</span><span class="line">        <span class="k">CASE</span>
</span><span class="line">            <span class="k">WHEN</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span> <span class="k">IS</span> <span class="k">NULL</span>
</span><span class="line">                <span class="k">THEN</span> <span class="n">CONCAT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">varchar</span><span class="p">,</span> <span class="p">[</span><span class="n">Id</span><span class="p">]),</span> <span class="s1">&#39;@example.com&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="k">ELSE</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span>
</span><span class="line">        <span class="k">END</span>
</span><span class="line">    <span class="p">)</span>
</span><span class="line">    <span class="p">,</span><span class="k">NULL</span>
</span><span class="line">    <span class="p">,</span><span class="k">NULL</span>
</span><span class="line">    <span class="p">,(</span><span class="k">SELECT</span> <span class="n">GETDATE</span><span class="p">())</span>
</span><span class="line">    <span class="p">,</span><span class="k">NULL</span>
</span><span class="line">    <span class="p">,</span><span class="k">NULL</span>
</span><span class="line">    <span class="p">,</span><span class="mi">0</span>
</span><span class="line">    <span class="p">,</span><span class="mi">0</span>
</span><span class="line"><span class="k">FROM</span> <span class="o">#</span><span class="n">tempSource_Table_Name</span>
</span><span class="line"><span class="c1">-- apply any addional filtering/sorting as needed</span>
</span><span class="line"><span class="c1">-- WHERE [Id] IS NOT NULL</span>
</span><span class="line"><span class="c1">-- ORDER BY EmailAddress</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This example shows that is quite easy to apply some data transformations to the source data before inserting it on my target table. All the power of Transact-SQL is available to make a serious import script using this strategy.</p>

<p><strong>Also I want to add to my import script some extra features:</strong></p>

<ul>
  <li>perform all my operations wrapped within a transaction;</li>
  <li>sanitize data before import (useful I want to test the import multiple times);</li>
  <li>demonstrate that is easy to import multiple files in one run.</li>
</ul>

<p><strong>Here the full script:</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Complete script with comments  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="cm">/* </span>
</span><span class="line"><span class="cm">    set target database</span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line">
</span><span class="line"><span class="n">USE</span> <span class="p">[</span><span class="n">Target_Database_Name</span><span class="p">]</span>
</span><span class="line"><span class="k">GO</span>
</span><span class="line">
</span><span class="line"><span class="cm">/* </span>
</span><span class="line"><span class="cm">    wrap everything in a transaction </span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line">
</span><span class="line"><span class="k">BEGIN</span> <span class="n">TRAN</span>
</span><span class="line"><span class="k">GO</span>
</span><span class="line">
</span><span class="line"><span class="cm">/* </span>
</span><span class="line"><span class="cm">    (optional) sanitize target table(s)</span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line">
</span><span class="line"><span class="c1">-- remove all rows</span>
</span><span class="line"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="p">[</span><span class="n">Target_Table_Name</span><span class="p">];</span>
</span><span class="line"><span class="k">GO</span>
</span><span class="line">
</span><span class="line"><span class="c1">-- if your the target table contains a identity key, reset its value</span>
</span><span class="line"><span class="n">DBCC</span> <span class="n">CHECKIDENT</span> <span class="p">([</span><span class="n">Target_Table_Name</span><span class="p">],</span> <span class="n">reseed</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class="line"><span class="k">GO</span>
</span><span class="line">
</span><span class="line"><span class="c1">-- extra sanitization operations like disabling triggers, FK&#39;s, etc</span>
</span><span class="line">
</span><span class="line"><span class="cm">/*</span>
</span><span class="line"><span class="cm">    creat a temp table, for each CSV that you wish to import, to hold CSV data</span>
</span><span class="line">
</span><span class="line"><span class="cm">    example CSV:</span>
</span><span class="line">
</span><span class="line"><span class="cm">    Id;Name;EmailAddress;MobileNumber</span>
</span><span class="line"><span class="cm">    1;John;john@gmail.com;123456789</span>
</span><span class="line"><span class="cm">    2;Mary;mary@gmail.com;123456789</span>
</span><span class="line">
</span><span class="line"><span class="cm">    table structure and column types must match with the CSV</span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line">
</span><span class="line"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">#</span><span class="n">tempSource_Table_Name</span> <span class="p">(</span>
</span><span class="line">    <span class="n">Id</span> <span class="nb">int</span><span class="p">,</span>
</span><span class="line">    <span class="p">[</span><span class="n">Name</span><span class="p">]</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
</span><span class="line">    <span class="n">EmailAddress</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">null</span><span class="p">,</span>
</span><span class="line">    <span class="n">MobileNumber</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">null</span>
</span><span class="line"><span class="p">);</span>
</span><span class="line"><span class="k">GO</span>
</span><span class="line">
</span><span class="line"><span class="cm">/*</span>
</span><span class="line"><span class="cm">    import CSV data to the temp table</span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line">
</span><span class="line"><span class="n">BULK</span> <span class="k">INSERT</span> <span class="o">#</span><span class="n">tempSource_Table_Name</span>
</span><span class="line"><span class="k">FROM</span> <span class="s1">&#39;C:\csv_file_full_path\source_table_data.csv&#39;</span>
</span><span class="line"><span class="k">WITH</span>
</span><span class="line"><span class="p">(</span>
</span><span class="line">    <span class="n">FIRSTROW</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span class="line">    <span class="n">FIELDTERMINATOR</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="n">ROWTERMINATOR</span> <span class="o">=</span> <span class="s1">&#39;\n&#39;</span><span class="p">,</span>
</span><span class="line">    <span class="n">CODEPAGE</span> <span class="o">=</span> <span class="s1">&#39;ACP&#39;</span>
</span><span class="line"><span class="p">);</span>
</span><span class="line"><span class="k">GO</span>
</span><span class="line">
</span><span class="line"><span class="cm">/*</span>
</span><span class="line"><span class="cm">    insert data to the target table using temp table as the source</span>
</span><span class="line"><span class="cm">    apply as many rules as needed to transform imput data</span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line">
</span><span class="line"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="p">[</span><span class="n">dbo</span><span class="p">].[</span><span class="n">Target_Table_Name</span><span class="p">]</span>
</span><span class="line">   <span class="p">([</span><span class="n">Name</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">MobileNumber</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">EmailAddress</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">Password</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">LastKnownIPAddress</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">CreatedOn</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">ChangedOn</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">VerifiedOn</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">Blocked</span><span class="p">]</span>
</span><span class="line">   <span class="p">,[</span><span class="n">BlockEmailMarketing</span><span class="p">])</span>
</span><span class="line"><span class="k">SELECT</span>
</span><span class="line">    <span class="p">[</span><span class="n">Name</span><span class="p">]</span>
</span><span class="line">    <span class="p">,[</span><span class="n">MobileNumber</span><span class="p">]</span>
</span><span class="line">    <span class="p">,(</span>
</span><span class="line">        <span class="k">CASE</span>
</span><span class="line">            <span class="k">WHEN</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span> <span class="k">IS</span> <span class="k">NULL</span>
</span><span class="line">                <span class="k">THEN</span> <span class="n">CONCAT</span><span class="p">(</span><span class="k">CONVERT</span><span class="p">(</span><span class="nb">varchar</span><span class="p">,</span> <span class="p">[</span><span class="n">Id</span><span class="p">]),</span> <span class="s1">&#39;@example.com&#39;</span><span class="p">)</span>
</span><span class="line">            <span class="k">ELSE</span> <span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span>
</span><span class="line">        <span class="k">END</span>
</span><span class="line">    <span class="p">)</span>
</span><span class="line">    <span class="p">,</span><span class="k">NULL</span>
</span><span class="line">    <span class="p">,</span><span class="k">NULL</span>
</span><span class="line">    <span class="p">,(</span><span class="k">SELECT</span> <span class="n">GETDATE</span><span class="p">())</span>
</span><span class="line">    <span class="p">,</span><span class="k">NULL</span>
</span><span class="line">    <span class="p">,</span><span class="k">NULL</span>
</span><span class="line">    <span class="p">,</span><span class="mi">0</span>
</span><span class="line">    <span class="p">,</span><span class="mi">0</span>
</span><span class="line"><span class="k">FROM</span> <span class="o">#</span><span class="n">tempSource_Table_Name</span>
</span><span class="line"><span class="c1">-- apply any addional filtering/sorting as needed</span>
</span><span class="line"><span class="c1">-- WHERE [Id] IS NOT NULL</span>
</span><span class="line"><span class="c1">-- ORDER BY EmailAddress</span>
</span><span class="line">
</span><span class="line"><span class="k">GO</span>
</span><span class="line">
</span><span class="line"><span class="cm">/*</span>
</span><span class="line"><span class="cm">    drop temp table(s)</span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line">
</span><span class="line"><span class="k">DROP</span> <span class="k">TABLE</span> <span class="o">#</span><span class="n">tempSource_Table_Name</span><span class="p">;</span>
</span><span class="line"><span class="k">GO</span>
</span><span class="line">
</span><span class="line"><span class="cm">/* </span>
</span><span class="line"><span class="cm">    extra operations</span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line">
</span><span class="line"><span class="c1">-- enable triggers, FK&#39;s, etc</span>
</span><span class="line">
</span><span class="line"><span class="cm">/*</span>
</span><span class="line"><span class="cm">    all good, time to commit transaction</span>
</span><span class="line"><span class="cm">*/</span>
</span><span class="line">
</span><span class="line"><span class="k">COMMIT</span> <span class="n">TRAN</span>
</span><span class="line"><span class="k">GO</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Device Emulation with Google Chrome Dev/Canary]]></title>
    <link href="http://ruionwriting.net/blog/2014/03/01/device-emulation-with-google-chrome-dev-slash-canary/"/>
    <updated>2014-03-01T11:44:00+00:00</updated>
    <id>http://ruionwriting.net/blog/2014/03/01/device-emulation-with-google-chrome-dev-slash-canary</id>
    <content type="html"><![CDATA[<p>This week, after seeing a snapshot that my friend ‘led’ posted on Facebook about some mobile tests for one of his projects, I’ve noticed about a certain device emulation feature  on Chrome developer tools. Hum…. that is interesting.</p>

<p>A simple Google search directed me right away for something I’ve already was aware but with some new funky stuff: </p>

<ul>
  <li>
    <p><a href="https://developers.google.com/chrome-developer-tools/docs/mobile-emulation">Chrome DevTools, Mobile Emulation</a></p>
  </li>
  <li>
    <p><a href="http://www.chromium.org/getting-involved/dev-channel">Chrome Release Channels</a></p>
  </li>
</ul>

<p>After the sexy photo we’ll get on how to install Chrome Canary build on Windows 8 and Chrome Dev on Arch Linux.</p>

<!-- more -->

<h2 id="nokia-lumia-emulation-in-action">Nokia Lumia emulation in action</h2>

<p>A simple example on Windows 8:</p>

<p><img class="center" src="http://ruionwriting.net/images/2014-03-01_canary_on_windows.png" title="Nokia Lumia emulation" /></p>

<h2 id="installing-canary-build-on-windows">Installing Canary Build on Windows</h2>

<p>Canary Build run side-by-side with your existing Chrome installation. </p>

<h3 id="using-chocolatey-cant-get-more-sweet">Using Chocolatey (can’t get more sweet)</h3>

<p>Google Chrome Canary is available through <a href="http://chocolatey.org/packages?q=canary">Chocolatey</a>, so simply install it using <code>cinst</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bat"><span class="line">c:\<span class="p">&gt;</span> <span class="n">cinst</span> GoogleChrome.Canary
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>If you using Windows and you don’t know what <a href="http://chocolatey.org/">Chocolatey</a> is you are missing all the fun.</p>

<h3 id="regular-download">Regular Download</h3>

<p>Simply <a href="https://www.google.com/intl/en/chrome/browser/canary.html">download</a> Chrome Canary run the installer.</p>

<h2 id="installing-chrome-dev-on-arch-linuxlinux">Installing Chrome Dev on Arch Linux/linux</h2>

<p>Chrome Dev run side-by-side with your existing Chromium installation. </p>

<p>This is my distro of choice but for any other popular like Debian based get the packages from <a href="http://www.chromium.org/getting-involved/dev-channel">Chrome Release Channels</a>.</p>

<p><code>google-chrome-dev</code> is available through <a href="https://aur.archlinux.org/">AUR</a>, so simply install it using <a href="https://wiki.archlinux.org/index.php/yaourt">yaourt</a>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">$ </span>yaourt -S google-chrome-dev
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="enabling-emulation">Enabling Emulation</h2>

<p>Enable the emulation panel following simple <a href="https://developers.google.com/chrome-developer-tools/docs/mobile-emulation#enable-emulation-panel">instructions</a>.</p>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>On this mobile era a lot of new tools for assisting web developers are arising. Could be a real challenge making compliant web sites/apps across the most popular devices. Having access to a good amount of devices at the same time for pre-launch tests/QA that also is usually a challenge. New tools are always welcome. </p>

<p>Thank you Google for continuing to give back cool tools for the comunity and thank you ‘led’ for the ‘tip’.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Improve Visual Studio 2013 performance]]></title>
    <link href="http://ruionwriting.net/blog/2014/02/14/improve-visual-studio-2013-performance/"/>
    <updated>2014-02-14T21:36:00+00:00</updated>
    <id>http://ruionwriting.net/blog/2014/02/14/improve-visual-studio-2013-performance</id>
    <content type="html"><![CDATA[<p>We all know that one of the main causes for Visual Studio to slow down is the use of many extensions simultaneously. Extra functionality means extra stuff happening under the hood, ultimately extra processing. What can I do if I the issue isn’t caused by an extension?</p>

<p>I’ve tested turning of something I really don’t need and the fact is that I’ve noticed some improvements.<!-- more --></p>

<h2 id="change-visual-experience-settings">Change visual experience settings</h2>
<p>Go to <code>Tools &gt; Options</code>, in the default view of <code>Environment &gt; General</code>, there is an option, under <code>Visual experience</code> called <strong>Automatically adjust visual experience based on client performance</strong>.
<img class="center" src="http://ruionwriting.net/images/2014-02-14_VS01.png" title="Visual experience (before)" /></p>

<p>Turning this off will disable visual client visual experience and hardware graphics acceleration.</p>

<p><img class="center" src="http://ruionwriting.net/images/2014-02-14_VS02.png" title="Visual experience (after)" /></p>

<p>This will take effect after you restart Visual Studio.</p>

<h2 id="startup-with-an-empty-environment">Startup with an empty environment</h2>
<p>This is more a personal preference. I don’t want to wait for the default environment to load with news, latest opened projects/solutions/files, etc. Latest projects and files are always available through the <code>File</code> menu options. </p>

<p><img class="center" src="http://ruionwriting.net/images/2014-02-14_VS03.png" title="Startup (before)" /></p>

<p>Switch to empty environment and disable content download. It’s strange to have content download enabled after switching to empty environment.</p>

<p><img class="center" src="http://ruionwriting.net/images/2014-02-14_VS04.png" title="Startup (app)" /></p>

<p>Now every time I start a new Visual Studio instance, I do that a lot during any normal work day, it loads clean and faster.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Handling ASP.NET PostBacks with URL Rewriting]]></title>
    <link href="http://ruionwriting.net/blog/2013/10/01/handling-asp-dot-net-postbacks-with-url-rewriting/"/>
    <updated>2013-10-01T22:18:00+01:00</updated>
    <id>http://ruionwriting.net/blog/2013/10/01/handling-asp-dot-net-postbacks-with-url-rewriting</id>
    <content type="html"><![CDATA[<p>Recently a collegue develop crossed with this strange error <strong><em>Validation of viewstate MAC failed…</em></strong> when posting a contacts form. Strangely the error only happened when using the re-written url off the contacts page (<code>contacts/</code>), calling <code>contacts.aspx</code> directly worked flawlessly. This is a C# port based on ScottGu’s <a href="http://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx">solution</a>.<!-- more --></p>

<p>A few minutes after I’ve remembered that I had to strugle with this issue when implementing a website using url-rewriting with <a href="http://iirf.codeplex.com/">IIRF</a> (it was a requirement). The problem is that when using url-rewriting the <code>&lt;form&gt;</code> control does not render the proper url but the re-written one. The solution is to write a form control adapter and I found, at the time I had the problem, the right solution from ScottGu’s. Since my language of choice is C# I’m going to share the solution right here:</p>

<h2 id="step-1">Step 1</h2>
<p><strong>Create a FormRewriterControlAdapter class</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>FormRewriterControlAdapter.cs </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Data</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Configuration</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Web.Security</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Web.UI</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Web.UI.HtmlControls</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Web.UI.WebControls</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Web.UI.WebControls.WebParts</span><span class="p">;</span>
</span><span class="line"><span class="k">using</span> <span class="nn">System.Xml.Linq</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">public</span> <span class="k">class</span> <span class="nc">FormRewriterControlAdapter</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Adapters</span><span class="p">.</span><span class="n">ControlAdapter</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Render</span><span class="p">(</span><span class="n">HtmlTextWriter</span> <span class="n">writer</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">base</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="k">new</span> <span class="n">RewriteFormHtmlTextWriter</span><span class="p">(</span><span class="n">writer</span><span class="p">));</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">public</span> <span class="k">class</span> <span class="nc">RewriteFormHtmlTextWriter</span> <span class="p">:</span> <span class="n">HtmlTextWriter</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">public</span> <span class="nf">RewriteFormHtmlTextWriter</span><span class="p">(</span><span class="n">HtmlTextWriter</span> <span class="n">writer</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">writer</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">this</span><span class="p">.</span><span class="n">InnerWriter</span> <span class="p">=</span> <span class="n">writer</span><span class="p">.</span><span class="n">InnerWriter</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="nf">RewriteFormHtmlTextWriter</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">TextWriter</span> <span class="n">writer</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span> <span class="p">(</span><span class="n">writer</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">base</span><span class="p">.</span><span class="n">InnerWriter</span> <span class="p">=</span> <span class="n">writer</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">WriteAttribute</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">string</span> <span class="k">value</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">fEncode</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="c1">// If the attribute we are writing is the &quot;action&quot; attribute, and we are not on a sub-control,</span>
</span><span class="line">        <span class="c1">// then replace the value to write with the raw URL of the request - which ensures that we&#39;ll</span>
</span><span class="line">        <span class="c1">// preserve the PathInfo value on postback scenarios</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="p">==</span> <span class="s">&quot;action&quot;</span><span class="p">)</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="n">HttpContext</span> <span class="n">context</span> <span class="p">=</span> <span class="n">HttpContext</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="s">&quot;ActionAlreadyWritten&quot;</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">                <span class="c1">// Because we are using an url reweriting HttpModule, we will use the</span>
</span><span class="line">                <span class="c1">// Request.RawUrl property within ASP.NET to retrieve the origional URL</span>
</span><span class="line">                <span class="c1">// before it was re-written.  You&#39;ll want to change the line of code below</span>
</span><span class="line">                <span class="c1">// if you use a different URL rewriting implementation.</span>
</span><span class="line">
</span><span class="line">                <span class="c1">// value = context.Request.RawUrl;</span>
</span><span class="line">                <span class="k">value</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">Request</span><span class="p">.</span><span class="n">ServerVariables</span><span class="p">[</span><span class="s">&quot;HTTP_X_REWRITE_URL&quot;</span><span class="p">];</span>
</span><span class="line">
</span><span class="line">                <span class="c1">// Indicate that we&#39;ve already rewritten the &lt;form&gt;&#39;s action attribute to prevent</span>
</span><span class="line">                <span class="c1">// us from rewriting a sub-control under the &lt;form&gt; control</span>
</span><span class="line">
</span><span class="line">                <span class="n">context</span><span class="p">.</span><span class="n">Items</span><span class="p">[</span><span class="s">&quot;ActionAlreadyWritten&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="k">base</span><span class="p">.</span><span class="n">WriteAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">fEncode</span><span class="p">);</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="step-2">Step 2</h2>
<p><strong>Add adapter to App_Browsers</strong></p>

<ol>
  <li>Add <code>ASP.NET</code> folder if it does not exists;</li>
  <li>Create <code>Form.browser</code>:</li>
</ol>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Form.browser </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="xml"><span class="line"><span class="nt">&lt;browsers&gt;</span>
</span><span class="line">    <span class="nt">&lt;browser</span> <span class="na">refID=</span><span class="s">&quot;Default&quot;</span><span class="nt">&gt;</span>
</span><span class="line">        <span class="nt">&lt;controlAdapters&gt;</span>
</span><span class="line">            <span class="nt">&lt;adapter</span> <span class="na">controlType=</span><span class="s">&quot;System.Web.UI.HtmlControls.HtmlForm&quot;</span>
</span><span class="line">                <span class="na">adapterType=</span><span class="s">&quot;FormRewriterControlAdapter&quot;</span> <span class="nt">/&gt;</span>
</span><span class="line">        <span class="nt">&lt;/controlAdapters&gt;</span>
</span><span class="line">    <span class="nt">&lt;/browser&gt;</span>
</span><span class="line"><span class="nt">&lt;/browsers&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>I hope you’ll find this information useful.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The best web application framework utopia]]></title>
    <link href="http://ruionwriting.net/blog/2013/09/24/the-best-web-application-framework-utopia/"/>
    <updated>2013-09-24T20:42:00+01:00</updated>
    <id>http://ruionwriting.net/blog/2013/09/24/the-best-web-application-framework-utopia</id>
    <content type="html"><![CDATA[<p>Many times I found IT professionals, in particular programmers, arguing about what is the best technology to adopt for a certain project or for all projects for a specific company. As a web developer with several years getting the hands dirty with .NET development I found myself frequently observing (or getting in to) discussions about the subject. I really try to avoid to get in the middle… Ok! Not really :P<!-- more --></p>

<p>The truth is that, most of the time, is hard to move away without throwing our own perspective. I did that the past and I admit that I was a bit fundamentalist defending my own perspective.</p>

<h2 id="discussions-like-what-is-best-php-or-aspnet-are-as-common-as-useless">Discussions like “what is best PHP or ASP.NET?” are as common as useless.</h2>
<p>The more I learn the more I say that all technologies, in this case web frameworks, have pro’s and conn’s and that we must choose the best having the focus on the task and on the result we want to achieve.</p>

<h2 id="for-me-aspnet-is-the-best-continue-reading-please">For me ASP.NET is the best (continue reading please)</h2>
<p>Naturally because is the one I use every day. I’ve already tried others like Java or PHP but I really like the way we can develop everything using a great IDE like Visual Studio and all the nice features that .NET ecosystem (web, desktop, services, etc) delivers. I love C# and with .NET I can do almost everything, core and services, with it.</p>

<h2 id="so-what-is-the-best-one">So what is the best one?</h2>
<p>The are so many of them, use the one that serves you better. The most used (Perl, PHP, Java, Python, Ruby, CFML, ASP, ASP.NET, etc) have great projects and platforms well known by everyone, so if a great project is using a certain technology and it works the way it is suppose to then is using the right technology, not necessarily the best but certainly the one that performs the job.</p>

<p>A simple equation:</p>

<p><code>secure + cost effective + well documented + well supported + good performance + flexible/extensible = the right choice</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Try something new: Octopress motivation]]></title>
    <link href="http://ruionwriting.net/blog/2013/09/21/try-something-new-octopress-motivation/"/>
    <updated>2013-09-21T15:28:00+01:00</updated>
    <id>http://ruionwriting.net/blog/2013/09/21/try-something-new-octopress-motivation</id>
    <content type="html"><![CDATA[<p>Real blogging, like <a href="http://www.hanselman.com/blog/">Scott Hanselman</a> does (and many others), is a serious thing that requires discipline and a personal commitment. I’ve failed to do anything even close <em>(&lt;1%???)</em> of what Scott does concerning sharing with the community real stuff that teach and empower any developer skills.<!-- more --></p>

<h2 id="im-a-failed-blogger">I’m a failed blogger</h2>
<p>I’ve a lot of excuses that sum up to NO TIME. What??? The truth is that I didn’t really enforce a discipline to blogging and the excuse about not having spare time and patience fitted just perfectly all this time. 3 years after my first blog post I have to try something new: a personal commitment to write something useful and clear with more regularity.</p>

<h2 id="i-want-to-learn-more">I want to learn more</h2>
<p>Blogging about findings/opinions (personal) related to my job daily challenges, problems and solutions is an opportunity to be a better programmer, person (yes, I work also with people) and ultimately a better professional. </p>

<h2 id="why-octopress">Why Octopress?</h2>
<p>Why not? I love <a href="http://git-scm.com/">git</a> and I want to learn new stuff so Octopress seems to be the perfect framework for it. Any Windows/.NET guy with some linux exposure will gain some extra skills in the process (empowers extra curiosity for Windows guts). Octopress it is, exiting confort zone…</p>

]]></content>
  </entry>
  
</feed>
